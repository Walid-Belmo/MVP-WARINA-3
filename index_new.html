<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESP32 Learning Game</title>
    
    <!-- CSS Imports -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="css/level-selector.css">
    <link rel="stylesheet" href="css/syntax-highlighting.css">
</head>
<body>
    <!-- Animated Background -->
    <div class="bg-animation">
        <!-- Floating Particles -->
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        
        <!-- Moving Gradient Overlays -->
        <div class="gradient-overlay"></div>
        <div class="gradient-overlay"></div>
        <div class="gradient-overlay"></div>
        <div class="gradient-overlay"></div>
        
        <!-- Geometric Shapes -->
        <div class="geometric-shape"></div>
        <div class="geometric-shape"></div>
        <div class="geometric-shape"></div>
        <div class="geometric-shape"></div>
    </div>

    <!-- Header Bar -->
    <div class="header">
        <div class="mission-title">üéØ MISSION 1: First Light</div>
        <button class="level-selector-btn" onclick="window.levelSelectorManager.toggle()">üìã LEVELS</button>
        <button class="audio-toggle-btn" onclick="window.audioManager.toggle()" style="background: #00D4FF; color: #000; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; margin-left: 10px;">üéµ Music</button>
    </div>

    <!-- Dedicated Timer Panel -->
    <div class="timer-panel">
        <div class="timer-header">
            <div class="clock-icon"></div>
            <div class="timer-label">TIME</div>
        </div>
        <div class="timer">00:00</div>
    </div>

    <!-- Code Execution Status -->
    <div class="code-status" id="codeStatus">
        <div>‚ö° Code Running...</div>
    </div>

    <!-- Error Display -->
    <div class="error-display" id="errorDisplay">
        <div class="error-content">
            <div class="error-icon">‚ùå</div>
            <div class="error-message"></div>
            <button class="error-close" onclick="window.uiManager.hideError()">‚úï</button>
        </div>
    </div>

    <!-- Win Modal -->
    <div class="modal" id="winModal" style="display: none;">
        <div class="modal-content win-modal">
            <div class="modal-icon">üéâ</div>
            <h2>Level Complete!</h2>
            <p>Great job! Your code matches the target sequence perfectly!</p>
            <div class="modal-buttons">
                <button class="btn btn-primary" onclick="window.uiManager.nextLevel()">Next Level</button>
                <button class="btn btn-secondary" onclick="window.uiManager.restartLevel()">Restart Level</button>
            </div>
        </div>
    </div>

    <!-- Lose Modal -->
    <div class="modal" id="loseModal" style="display: none;">
        <div class="modal-content lose-modal">
            <div class="modal-icon">üíÄ</div>
            <h2>Time's Up!</h2>
            <p>Don't give up! Try again and match the target sequence.</p>
            <div class="modal-buttons">
                <button class="btn btn-primary" onclick="window.uiManager.restartLevel()">Try Again</button>
                <button class="btn btn-secondary" onclick="window.uiManager.hideLoseModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Left Panel - Microcontroller -->
        <div class="left-panel">
            <!-- Connection Lines Container -->
            <div class="connection-lines" id="connectionLines"></div>
            
            <!-- Microcontroller Visualization -->
            <div class="microcontroller-container">
                <!-- Elapsed Timer Display (only visible during target animation) -->
                <div class="elapsed-timer" id="elapsedTimer" style="display: none;">
                    <div class="elapsed-timer-label">ELAPSED TIME</div>
                    <div class="elapsed-timer-value">00:00.0</div>
                </div>

                <!-- Microcontroller -->
                <div class="microcontroller">
                    <!-- Top Pins -->
                    <div class="pins-top">
                        <div class="pin">
                            <div class="pin-circle" data-pin="13"></div>
                            <div class="pin-label">D13</div>
                        </div>
                        <div class="pin">
                            <div class="pin-circle" data-pin="12"></div>
                            <div class="pin-label">D12</div>
                        </div>
                        <div class="pin">
                            <div class="pin-circle" data-pin="11"></div>
                            <div class="pin-label">D11</div>
                        </div>
                        <div class="pin">
                            <div class="pin-circle" data-pin="10"></div>
                            <div class="pin-label">D10</div>
                        </div>
                    </div>
                    
                    <div class="microcontroller-text">¬µC</div>
                    
                    <!-- Bottom Pins -->
                    <div class="pins-bottom">
                        <div class="pin">
                            <div class="pin-circle" data-pin="9"></div>
                            <div class="pin-label">D9</div>
                        </div>
                        <div class="pin">
                            <div class="pin-circle" data-pin="8"></div>
                            <div class="pin-label">D8</div>
                        </div>
                        <div class="pin">
                            <div class="pin-circle"></div>
                            <div class="pin-label">GND</div>
                        </div>
                        <div class="pin">
                            <div class="pin-circle"></div>
                            <div class="pin-label">5V</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Components Section -->
            <div class="components-section">
                <div class="components-header">
                    <div class="components-title">üîå Components</div>
                    <div>
                        <button class="add-component-btn" onclick="addLEDComponent()">+ Add LED</button>
                        <button class="add-component-btn" onclick="addMotorComponent()">+ Add Motor</button>
                    </div>
                </div>
                <div class="components-grid" id="componentsGrid">
                    <!-- Components will be added here dynamically -->
                </div>
            </div>

            <!-- Variables Section -->
            <div class="variables-section">
                <div class="variables-header">
                    <div class="variables-icon"></div>
                    <div class="variables-title">Variables</div>
                </div>
                <div class="variables-content">Aucune variable</div>
            </div>

            <!-- Serial Control Section (shown only for serial levels) -->
            <div class="serial-control-section" id="serialControlSection">
                <div class="serial-control-header">
                    <div class="serial-control-icon"></div>
                    <div class="serial-control-title">‚ö° Serial Control</div>
                </div>

                <div class="serial-input-area">
                    <div class="serial-input-label">Type a number and press Enter:</div>
                    <div class="serial-input-wrapper">
                        <input type="number"
                               class="serial-input"
                               id="serialInput"
                               placeholder="Enter integer value...">
                        <button class="serial-send-btn" id="serialSendBtn">SEND</button>
                    </div>
                </div>

                <div class="serial-variable-display">
                    <div class="serial-variable-label">üì¶ Variable Value:</div>
                    <div class="serial-variable-box" id="serialVariableBox">
                        <span class="serial-variable-name">value</span>
                        <span class="serial-variable-equals">=</span>
                        <span class="serial-variable-value" id="serialVariableValue">
                            <span class="serial-variable-empty">No value yet</span>
                        </span>
                    </div>
                </div>
            </div>

            <!-- Left Panel Buttons -->
            <div class="left-buttons">
                <button class="btn btn-play">‚ñ∂Ô∏è PLAY TARGET</button>
                <button class="btn btn-replay">üîÑ REPLAY</button>
            </div>

            <!-- Additional Content Section for Scrolling -->
            <div class="additional-content">
                <div class="components-section">
                    <div class="components-header">
                        <div class="components-title">üìö Learning Resources</div>
                    </div>
                    <div style="color: #b0b0b0; font-size: 14px; line-height: 1.6;">
                        <p>Welcome to the ESP32 Learning Game! This interactive platform helps you learn ESP32 microcontroller programming through hands-on experience.</p>
                        <br>
                        <p><strong>Getting Started:</strong></p>
                        <ul style="margin-left: 20px;">
                            <li>Connect components to the ESP32 pins</li>
                            <li>Write ESP32 code in the editor</li>
                            <li>Run your code to see the results</li>
                            <li>Use hints when you need help</li>
                        </ul>
                        <br>
                        <p><strong>Mission 1: First Light</strong></p>
                        <p>Your goal is to make an LED blink on pin 13. Try connecting an LED component and writing code to control it!</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Panel - Code Editor -->
        <div class="right-panel">
            <div class="code-editor-container">
                <div class="editor-header">
                    <h3>üíª ESP32 Code Editor</h3>
                    <div class="editor-info">Write your ESP32 code and watch it execute on the microcontroller!</div>
                </div>
                <div class="code-editor-wrapper">
                    <div class="line-numbers" id="lineNumbers"></div>
                    <div class="syntax-overlay-container">
                        <div class="syntax-overlay" id="syntaxOverlay"></div>
                    </div>
                    <textarea class="code-editor code-editor-with-lines code-editor-with-syntax" id="codeEditor" placeholder="Write your ESP32 code here...">void setup() {
  pinMode(13, OUTPUT);
}

void loop() {
  digitalWrite(13, HIGH);
  delay(1000);
  digitalWrite(13, LOW);
  delay(1000);
}</textarea>
                </div>
                <div class="code-completion" id="codeCompletion" style="display: none;"></div>
                <div class="editor-status">
                    <span>ESP32 IDE</span>
                    <span class="cursor-position" id="cursorPosition">Line 1, Column 1</span>
                </div>
            </div>

            <!-- Right Panel Buttons -->
            <div class="right-buttons">
                <button class="btn btn-run">‚ñ∂Ô∏è RUN CODE</button>
                <button class="btn btn-reset">üîÑ RESET</button>
                <button class="btn btn-hint">üí° HINT</button>
            </div>

            <!-- Additional Code Examples Section -->
            <div class="code-examples-section" style="margin-top: 20px;">
                <div class="components-section">
                    <div class="components-header">
                        <div class="components-title">üí° Code Examples</div>
                    </div>
                    <div style="color: #b0b0b0; font-size: 12px; line-height: 1.5;">
                        <p><strong>Basic LED Blink:</strong></p>
                        <pre style="background: #1a2a3a; padding: 10px; border-radius: 5px; margin: 10px 0; overflow-x: auto;">
void setup() {
  pinMode(13, OUTPUT);
}

void loop() {
  digitalWrite(13, HIGH);
  delay(1000);
  digitalWrite(13, LOW);
  delay(1000);
}</pre>
                        <p><strong>Multiple LEDs:</strong></p>
                        <pre style="background: #1a2a3a; padding: 10px; border-radius: 5px; margin: 10px 0; overflow-x: auto;">
void setup() {
  pinMode(13, OUTPUT);
  pinMode(12, OUTPUT);
}

void loop() {
  digitalWrite(13, HIGH);
  digitalWrite(12, LOW);
  delay(500);
  digitalWrite(13, LOW);
  digitalWrite(12, HIGH);
  delay(500);
}</pre>
                        <p><strong>ESC/Motor Control with ESP32 Servo:</strong></p>
                        <pre style="background: #1a2a3a; padding: 10px; border-radius: 5px; margin: 10px 0; overflow-x: auto;">
#include &lt;ESP32Servo.h&gt;

Servo motor1;  // First ESC/motor
Servo motor2;  // Second ESC/motor

void setup() {
  // Attach motors to pins (1000-2000¬µs range)
  motor1.attach(9, 1000, 2000);
  motor2.attach(10, 1000, 2000);

  // ARM the ESCs (safety protocol)
  motor1.writeMicroseconds(1000);  // 0% throttle
  motor2.writeMicroseconds(1000);  // 0% throttle
  delay(3000);  // Wait for ESCs to ARM

  // Set desired speeds
  motor1.writeMicroseconds(1500);  // 50% throttle
  motor2.writeMicroseconds(1250);  // 25% throttle
}

void loop() {
  // Motors maintain their speed
}</pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Imports -->
    <!-- Core Systems -->
    <script src="js/core/gameState.js"></script>
    <script src="js/core/pinManager.js"></script>
    <script src="js/core/arduinoParser.js"></script>
    <script src="js/core/sequenceExtractor.js"></script>
    <script src="js/core/sequenceValidator.js"></script>
    
    <!-- Level System -->
    <script src="js/levels/levelData.js"></script>
    <script src="js/levels/levelManager.js"></script>
    
    <!-- Component Management -->
    <script src="js/components/componentManager.js"></script>
    
    <!-- Execution Systems -->
    <script src="js/execution/executionRecorder.js"></script>
    <script src="js/execution/codeExecutor.js"></script>
    
    <!-- Game Flow Systems -->
    <script src="js/game/validationManager.js"></script>
    <script src="js/game/gameFlowManager.js"></script>
    
    <!-- UI Systems -->
    <script src="js/ui/syntaxHighlighter.js"></script>
    <script src="js/ui/codeEditor.js"></script>
    <script src="js/ui/timerManager.js"></script>
    <script src="js/ui/targetAnimationPlayer.js"></script>
    <script src="js/ui/modalManager.js"></script>
    <script src="js/ui/visualEffectsManager.js"></script>
    <script src="js/ui/eventManager.js"></script>
    <script src="js/ui/levelSelectorManager.js"></script>
    <script src="js/ui/serialControlManager.js"></script>
    <script src="js/ui/audioManager.js"></script>
    <script src="js/ui/uiManager.js"></script>
    
    <!-- Background Effects -->
    <script src="fx.js"></script>
    
    <!-- Main Application -->
    <script src="js/app.js"></script>
</body>
</html>
